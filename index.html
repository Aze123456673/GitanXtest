<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>D√©obfuscateur Lua - Grok Edition 2026 (Am√©lior√©)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body { 
    font-family: 'Segoe UI', sans-serif; 
    background: linear-gradient(135deg, #0d001a, #1a0033); 
    color: #d0c0ff; 
    margin:0; 
    padding:20px; 
  }
  h1 { color: #bb66ff; text-align:center; margin-bottom: 0.8em; }
  .container { max-width:1100px; margin:auto; }
  .mode-select { text-align:center; margin:1.5em 0; }
  select { 
    padding:8px 16px; 
    font-size:1rem; 
    background:#222244; 
    color:#fff; 
    border:1px solid #664488; 
    border-radius:4px; 
  }
  textarea { 
    width:100%; 
    max-width:1000px; 
    height:300px; 
    margin:0 auto 1.5em; 
    display:block; 
    background:#111122; 
    color:#e0d0ff; 
    border:1px solid #553366; 
    border-radius:8px; 
    padding:16px; 
    font-family:monospace; 
    font-size:14px; 
    resize:vertical;
  }
  button { 
    display:block; 
    margin:1.5em auto; 
    padding:14px 40px; 
    font-size:1.2rem; 
    background:#7f00ff; 
    color:white; 
    border:none; 
    border-radius:6px; 
    cursor:pointer; 
    transition:0.2s; 
  }
  button:hover { background:#9f40ff; transform:scale(1.05); }
  button:active { transform:scale(0.98); }
  #result { 
    width:100%; 
    max-width:1000px; 
    margin:1.5em auto; 
    background:#0a0011; 
    border:1px solid #442266; 
    border-radius:8px; 
    padding:18px; 
    white-space:pre-wrap; 
    font-family:monospace; 
    min-height:180px; 
    color:#b0ffb0; 
    line-height:1.4;
  }
  .error { color: #ff9999 !important; }
</style>
</head>
<body>
<div class="container">
  <h1>D√©obfuscateur Lua (Street + WeAreDevs)</h1>
 
  <div class="mode-select">
    <label for="mode">Mode : </label>
    <select id="mode">
      <option value="general">G√©n√©ral (basique)</option>
      <option value="wearedevs" selected>WeAreDevs (am√©lior√©)</option>
    </select>
  </div>

  <textarea id="input" placeholder="Colle ton code Lua obfusqu√© ici..."></textarea>
 
  <button onclick="deobfuscate()">D√âOBFUSQUER üî•</button>
 
  <div id="result">R√©sultat ici... (colle ton script et choisis un mode)</div>
</div>

<script>
const generalPatterns = [
  { regex: /loadstring\s*\(/g, replace: 'load(' },
  { regex: /\\x([0-9a-fA-F]{2})/g, replace: (_, h) => String.fromCharCode(parseInt(h, 16)) },
  { regex: /\\([0-7]{1,3})/g, replace: (_, o) => String.fromCharCode(parseInt(o, 8)) },
  // Cha√Æne de gsub classique
  {
    regex: /\b_\s*=\s*([^:]+?)\s*:\s*gsub\s*\(\s*"([^"]+)"\s*,\s*"([^"]*)"\s*\)/g,
    replace: (m, s, p, r) => {
      try {
        const safeP = p.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        return s.replace(new RegExp(safeP, 'g'), r);
      } catch {
        return m;
      }
    }
  }
];

const wearedevsPatterns = [
  // D√©codage octal plus robuste (g√®re \123\56 ou 123\56 etc.)
  {
    regex: /"((?:\\?\d{1,3})+)"/g,
    replace: (match, content) => {
      try {
        let result = '';
        let i = 0;
        while (i < content.length) {
          if (content[i] === '\\' && /\d/.test(content[i + 1])) {
            let num = '';
            i++;
            while (i < content.length && /\d/.test(content[i]) && num.length < 3) {
              num += content[i++];
            }
            result += String.fromCharCode(parseInt(num, 8));
          } else {
            result += content[i++];
          }
        }
        return `"${result.replace(/"/g, '\\"').replace(/\n/g, '\\n')}"`;
      } catch {
        return match;
      }
    }
  },
  // Supprime la table de mapping (souvent inutile apr√®s d√©codage)
  { regex: /local\s+[a-zA-Z_]\s*=\s*{[^}]+?}/g, replace: '// Mapping table supprim√©e' },
  // Remplace le decodeur en boucle par un commentaire
  {
    regex: /for\s+[a-zA-Z_]\s*=\s*[^,]+?,\s*#[^,]+?,\s*[^)]+?\s*do[\s\S]*?end/g,
    replace: '// WeAreDevs string decoder loop remplac√©'
  }
];

function deobfuscate() {
  const input = document.getElementById('input').value.trim();
  const mode = document.getElementById('mode').value;
  const resultDiv = document.getElementById('result');

  if (!input) {
    resultDiv.innerHTML = "Colle un script quand m√™me bg üòè";
    resultDiv.className = 'error';
    return;
  }

  let code = input;

  // √âtape 1 : patterns g√©n√©raux
  for (const p of generalPatterns) {
    if (typeof p.replace === 'function') {
      code = code.replace(p.regex, p.replace);
    } else {
      code = code.replace(p.regex, p.replace);
    }
  }

  // √âtape 2 : patterns WeAreDevs si s√©lectionn√©
  if (mode === 'wearedevs') {
    for (const p of wearedevsPatterns) {
      if (typeof p.replace === 'function') {
        code = code.replace(p.regex, p.replace);
      } else {
        code = code.replace(p.regex, p.replace);
      }
    }

    // D√©codage suppl√©mentaire pour les strings qui auraient √©chapp√©
    code = code.replace(/"((?:\\?\d{1,3})+)"/g, wearedevsPatterns[0].replace);
  }

  // Nettoyage final
  code = code
    .replace(/\s{2,}/g, ' ')           // multiples espaces ‚Üí un seul
    .replace(/;\s*/g, ';\n')           // ; ‚Üí nouvelle ligne
    .replace(/\s*end\s*/g, '\nend\n')  // meilleur espacement end
    .replace(/\s*then\s*/g, '\nthen\n')
    .replace(/\s*else\s*/g, '\nelse\n')
    .replace(/\s*elseif\s*/g, '\nelseif ')
    .replace(/,\s*/g, ', ')
    .replace(/\(\s*/g, '(')
    .replace(/\s*\)/g, ')')
    .replace(/{\s*/g, '{ ')
    .replace(/\s*}/g, ' }')
    .trim();

  // R√©sultat
  if (code.length < 50) {
    resultDiv.innerHTML = "(Quasiment rien r√©cup√©r√©... essaie l‚Äôautre mode ou un autre script)";
    resultDiv.className = 'error';
  } else {
    resultDiv.textContent = code;
    resultDiv.className = '';
  }
}
</script>
</body>
</html>
