<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>DÃ©obfuscateur Lua - Lune + WeAreDevs Fix 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0d001a, #1a0033);
    color: #d0c0ff;
    margin: 0;
    padding: 20px;
  }
  .container { max-width: 1100px; margin: auto; }
  h1 { color: #bb66ff; text-align: center; margin-bottom: 0.6em; }
  .info { text-align: center; color: #aa88ff; font-size: 0.95rem; margin: 12px 0; }
  .mode-select { text-align: center; margin: 16px 0; }
  select {
    padding: 8px 16px;
    font-size: 1rem;
    background: #222244;
    color: #fff;
    border: 1px solid #664488;
    border-radius: 4px;
  }
  textarea {
    width: 100%;
    max-width: 1000px;
    height: 320px;
    margin: 16px auto;
    display: block;
    background: #111122;
    color: #e0d0ff;
    border: 1px solid #553366;
    border-radius: 8px;
    padding: 16px;
    font-family: monospace;
    font-size: 14px;
    resize: vertical;
  }
  button {
    display: block;
    margin: 24px auto;
    padding: 14px 50px;
    font-size: 1.3rem;
    background: #7f00ff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    background: #9f40ff;
    transform: scale(1.05);
  }
  #result {
    width: 100%;
    max-width: 1000px;
    margin: 20px auto;
    background: #0a0011;
    border: 1px solid #442266;
    border-radius: 8px;
    padding: 18px;
    white-space: pre-wrap;
    font-family: monospace;
    min-height: 200px;
    color: #b0ffb0;
    line-height: 1.45;
  }
  .error { color: #ff9999 !important; }
</style>
</head>
<body>

<div class="container">
  <h1>DÃ©obfuscateur Lua (Lune + WeAreDevs/Street)</h1>
  <div class="info">Colle ton code obfusquÃ© â†’ choisis mode â†’ dÃ©obfusque</div>

  <div class="mode-select">
    <label for="mode">Mode : </label>
    <select id="mode">
      <option value="general">GÃ©nÃ©ral (basique)</option>
      <option value="wearedevs" selected>WeAreDevs v1.x</option>
      <option value="street">Street / XOR</option>
    </select>
  </div>

  <textarea id="input" placeholder="Colle ton code Lua obfusquÃ© ici..."></textarea>

  <button onclick="deobfuscate()">DÃ‰OBFUSQUER ðŸ”¥</button>

  <div id="result">RÃ©sultat ici... (change de mode si besoin)</div>
</div>

<script>
// Patterns de base (toujours appliquÃ©s)
const generalPatterns = [
  { regex: /loadstring\s*\(/g, replace: 'load(' },
  { regex: /\\x([0-9a-fA-F]{2})/gi, replace: (_, h) => String.fromCharCode(parseInt(h, 16)) },
  { regex: /\\([0-7]{1,3})/g, replace: (_, o) => String.fromCharCode(parseInt(o, 8)) },
  // gsub chain simple
  {
    regex: /\b_\s*=\s*([^:]+?)\s*:\s*gsub\s*\(\s*"([^"]+)"\s*,\s*"([^"]*)"\s*\)/g,
    replace: (match, source, pattern, repl) => {
      try {
        const safePattern = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        return source.replace(new RegExp(safePattern, 'g'), repl);
      } catch {
        return match;
      }
    }
  }
];

// Patterns WeAreDevs v1 (octal + mapping)
const wearedevsPatterns = [
  // DÃ©codeur octal robuste (gÃ¨re plusieurs formats)
  {
    regex: /"((?:\\?\d{1,3})+)"/g,
    replace: (match, content) => {
      try {
        let result = '';
        let i = 0;
        while (i < content.length) {
          if (content[i] === '\\' && /\d/.test(content[i + 1])) {
            let num = '';
            i++;
            while (i < content.length && /\d/.test(content[i]) && num.length < 3) {
              num += content[i++];
            }
            result += String.fromCharCode(parseInt(num, 8));
          } else {
            result += content[i++];
          }
        }
        return `"${result.replace(/"/g, '\\"')}"`;
      } catch {
        return match;
      }
    }
  },
  // Supprime mapping table
  { regex: /local\s+o\s*=\s*{[^}]*}/g, replace: '// o = mapping table supprimÃ©e' },
  // Supprime boucle decode
  { regex: /for\s+[a-zA-Z_]\s*=\s*[^,]+?,\s*#[^,]+?,\s*[^)]+?\s*do[\s\S]*?end/g, replace: '// Boucle de dÃ©codage supprimÃ©e' }
];

function deobfuscate() {
  const input = document.getElementById('input').value.trim();
  const mode = document.getElementById('mode').value;
  const resultDiv = document.getElementById('result');

  if (!input) {
    resultDiv.innerHTML = "Mets du code quand mÃªme bg ðŸ˜";
    resultDiv.className = 'error';
    return;
  }

  let code = input;

  // 1. Toujours appliquer les patterns gÃ©nÃ©raux
  generalPatterns.forEach(p => {
    code = code.replace(p.regex, typeof p.replace === 'function' ? p.replace : p.replace);
  });

  // 2. Appliquer patterns spÃ©cifiques selon le mode
  if (mode === 'wearedevs') {
    wearedevsPatterns.forEach(p => {
      code = code.replace(p.regex, typeof p.replace === 'function' ? p.replace : p.replace);
    });

    // Petit extra : rÃ©-essaye sur toutes les strings restantes
    code = code.replace(/"((?:\\?\d{1,3})+)"/g, wearedevsPatterns[0].replace);
  }

  // 3. Nettoyage final (plus doux pour ne pas casser)
  code = code
    .replace(/\s{2,}/g, ' ')           // espaces multiples â†’ un seul
    .replace(/;\s*/g, ';\n')           // chaque ; sur nouvelle ligne
    .replace(/\s*end\s*/g, '\nend\n')
    .replace(/\s*then\s*/g, '\nthen\n')
    .replace(/\s*else\s*/g, '\nelse\n')
    .replace(/\s*elseif\s*/g, '\nelseif ')
    .trim();

  // Affichage rÃ©sultat
  if (code.length < 40) {
    resultDiv.innerHTML = "(Presque rien rÃ©cupÃ©rÃ©... essaie un autre mode)";
    resultDiv.className = 'error';
  } else {
    resultDiv.textContent = code;
    resultDiv.className = '';
  }
}
</script>
</body>
</html>
